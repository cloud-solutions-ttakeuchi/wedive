# WeDive プロジェクト開発ルール

このファイルは、AIアシスタント（Agent）の振る舞いを規定する**絶対的なルール**です。Agentは作業を開始する前に必ずこの内容を確認し、遵守しなければなりません。ユーザーからの明示的な例外許可がない限り、本ルールを最優先してください。

## 1. コミュニケーション・基本原則
- **使用言語:** 会話およびドキュメント（事実記載）はすべて**日本語**で行うこと。
- **簡潔さ:** ユーザーにストレスを与えないよう、簡潔かつ正確な報告を心がける。
- **独断の禁止:** 「よかれと思って」の先回り作業、ロジック変更、ファイル削除は一切禁止する。
- **不明点の解消:** ユーザーの意図を100%汲み取り、不明な点は勝手に推測せず必ず質問すること。

## 2. 変更プロセス（提案と実行の分離）
AIが勝手にコードを書き換えることを防ぐため、以下の手順を厳守すること。

1. **提案:** 変更操作（実装・修正・削除）を行う前に、まず変更内容と理由をユーザーに説明する。
2. **待機:** 提案と同時に実行してはならない。必ずユーザーの許可（Goodボタンまたは文言での「OK」「進めて」など）を待つ。
3. **実行:** 許可を得た後、**最小限の範囲**に限定して修正を行う。

## 3. 実装・設計品質
- **既存仕様の尊重:** バッチサイズ、ループ構造、バリデーション等の設計意図を壊さない。
- **Feature Flag:** 新機能の実装時は必ず feature flag を導入し、その使用方法を `README.md` に記載すること。
- **テスト:** 実装完了後、必ず `tests/` ディレクトリにユニットテストを追加すること。
- **ドキュメント参照と更新:**
    - データベース操作・変更：`DATABASE_DESIGN.md` を参照・更新する。
    - インフラ変更：`INFRASTRUCTURE.md` を参照・更新する。
    - 機能の追加・変更：`FUNCTIONALITY.md` を参照・更新する。
    - いずれのドキュメントも、事実に基き、日本語で簡潔に記載すること。
- **仕様の遵守:** 機能実装・改修時は上記ドキュメントを正として進めること。仕様変更が必要な場合は、必ず事前にユーザーの許可を得てからドキュメントとコードを更新すること。

## 4. 完了定義 (Definition of Done)
タスクを「完了」とする前に、以下のチェックリストをすべて満たしていることを自己確認し、完了報告とあわせて状況を提示すること。

- [ ] **許可の確認:** すべての変更について、事前にユーザーの許可を得たか？
- [ ] **最小修正:** 許可を得た範囲外の不要なコード変更（リファクタリング等）を行っていないか？
- [ ] **テスト実装:** `tests/` に適切なユニットテストを追加したか？
- [ ] **Feature Flag:** Flagを実装し、`README.md` に説明を書いたか？
- [ ] **ドキュメント更新:** 以下のファイルの更新漏れはないか？
    - [ ] `CHANGELOG.md` / `RELEASE_NOTES.md`
    - [ ] `DATABASE_DESIGN.md` （DB/スキーマ変更時）
    - [ ] `INFRASTRUCTURE.md` （インフラ設計変更時）
    - [ ] `FUNCTIONALITY.md` （機能一覧変更時）

## 5. wedive-web（通称：web版）, wedive-app（通称：モバイル版, アプリ版）
・web版とアプリ版の双方に機能がある場合は処理ロジックを合わせること。バックエンドは同じデータを参照しているため、論理破綻することのないようにする必要がある。UIなどにより機能を削るケースがある場合は私に申し出ること。
