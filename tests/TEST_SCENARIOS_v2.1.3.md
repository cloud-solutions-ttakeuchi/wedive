# テストシナリオ v2.1.3 (AI Data Cleansing System)

本書は、WeDive バージョン2.1.3 で導入された「AIデータクレンジング・生物マッピングシステム」を検証するためのテストシナリオです。

## 1. 機能: AI Data Cleansing Dashboard & Filtering

**概要:** 階層フィルタ、検索機能、およびジョブ実行範囲の制御を検証します。

| シナリオID | テストケース | 手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| **CLN-01** | UIレイアウトと左寄せ | 1. 管理画面の `Data Cleansing` を開く。<br>2. ダッシュボードの解説テキストを確認する。 | テキストが左寄せで表示され、1文字ずつ縦並びになるようなレイアウト崩れがないこと。<br>ヘッダーに青い盾（ShieldCheck）アイコンが表示されていること。 |
| **CLN-02** | 階層フィルタ (Hierarchy) | 1. `範囲指定` モードを選択する。<br>2. `Region` で「沖縄」等を選択する。<br>3. `Zone` プルダウンを確認する。 | `Zone` の選択肢が「沖縄」に属するものだけに絞り込まれていること。<br>同様に `Area` も `Zone` に連動してフィルタリングされること。 |
| **CLN-03** | ポイント検索 | 1. `Point Selection` の検索窓にポイント名の一部を入力する。 | 入力内容に一致するポイントのみがプルダウンの選択肢に表示されること。 |
| **CLN-04** | 生物検索 | 1. `Target Creature` の検索窓に生物名や科名を入力する。 | 一致する生物のみが表示されること。 |
| **CLN-05** | スコープ確認ダイアログ | 1. `Region` だけを選択し、`Area` や `Point` は空にする。<br>2. `クレンジング実行開始` をクリックする。 | 「指定リージョン全件」が対象範囲である旨の確認メッセージが表示されること。 |

## 2. 機能: AI Execution & Context Caching (エミュレータ/開発環境)

**概要:** AIエンジンの動作と、コスト削減のためのコンテキストキャッシュが機能しているかを検証します。

| シナリオID | テストケース | 手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| **EXEC-01** | AIマッピング実行 | 1. `Specific` モードで1ポイント・1生物を指定して実行する。 | ジョブが正常に受理され、「数分後に結果が反映されます」のアラートが出ること。 |
| **EXEC-02** | 判定結果の生成 | 1. 実行後、Firestoreエミュレータまたは開発環境の `point_creatures` コレクションを確認する。 | 新しいドキュメントが `status: "pending"` で作成されていること。<br>`confidence`（信頼度）と `reasoning`（根拠）が含まれていること。 |
| **EXEC-03** | キャッシュ利用 (Python) | 1. `scripts/cleansing_pipeline.py` を実行する。 | ログにキャッシュ作成または利用に関するメッセージが表示され、APIのレスポンスが高速（2回目以降）であること。 |

## 3. 機能: Review Engine (承認ワークフロー)

**概要:** AIの提案を人間が精査し、本番反映（Active化）するフローを検証します。

| シナリオID | テストケース | 手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| **REV-01** | 表示切り替え | 1. `Review Engine` タブを開く。<br>2. `By Point` と `By Creature` を切り替える。 | それぞれポイント軸、生物軸で正しくリストが表示・切り替わること。 |
| **REV-02** | 承認 (Approve) | 1. `pending` 状態のデータの `Check` アイコンをクリックする。 | データの `status` が `active`（または `approved`）に更新されること。<br>ポイント詳細画面でその生物が表示されるようになること。 |
| **REV-03** | 却下 (Reject) | 1. 不要な提案の `X` アイコンをクリックする。 | データが物理削除、またはリストから除外されること。 |
| **REV-04** | ⓘ マークの詳細表示 | 1. ダッシュボードの `TOTAL MAPPINGS` 横の ⓘ にマウスを重ねる。 | 「承認済みと保留中の両方を含みます」というツールチップが表示されること。 |

## 4. 機能: Cloud Run Job 

**概要:** コンテナ化したバッチ処理エンジンのデプロイと実行を検証します。

| シナリオID | テストケース | 手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| **RUN-01** | ジョブのデプロイ | 1. `gcloud run jobs list` を実行する。 | `cleansing-job` がリストに存在すること。 |
| **RUN-02** | ジョブの実行 | 1. `gcloud run jobs execute cleansing-job` を実行する。<br>2. Google Cloud コンソールでログを確認する。 | プログラムが正常に起動し、Firestore への書き込みが開始されること。 |
